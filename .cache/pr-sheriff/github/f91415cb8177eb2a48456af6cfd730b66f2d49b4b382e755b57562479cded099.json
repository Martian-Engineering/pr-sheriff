[
  {
    "url": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2726325539",
    "pull_request_review_id": 3704617574,
    "id": 2726325539,
    "node_id": "PRRC_kwDOQb6kR86igG0j",
    "diff_hunk": "@@ -155,10 +155,21 @@ export function createCronTool(opts?: CronToolOptions): AnyAgentTool {\n             }),\n           );\n         case \"add\": {\n-          if (!params.job || typeof params.job !== \"object\") {\n+          if (params.job === null || params.job === undefined) {\n             throw new Error(\"job required\");\n           }\n-          const job = normalizeCronJobCreate(params.job) ?? params.job;\n+          let rawJob: unknown = params.job;\n+          if (typeof rawJob === \"string\") {\n+            try {\n+              rawJob = JSON.parse(rawJob);\n+            } catch {\n+              throw new Error(\"job must be object\");",
    "path": "src/agents/tools/cron-tool.ts",
    "commit_id": "b856c154851755b55365c7ad193d21b2588370cd",
    "original_commit_id": "b856c154851755b55365c7ad193d21b2588370cd",
    "user": {
      "login": "Copilot",
      "id": 175728472,
      "node_id": "BOT_kgDOCnlnWA",
      "avatar_url": "https://avatars.githubusercontent.com/in/946600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Copilot",
      "html_url": "https://github.com/apps/copilot-pull-request-reviewer",
      "followers_url": "https://api.github.com/users/Copilot/followers",
      "following_url": "https://api.github.com/users/Copilot/following{/other_user}",
      "gists_url": "https://api.github.com/users/Copilot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Copilot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Copilot/subscriptions",
      "organizations_url": "https://api.github.com/users/Copilot/orgs",
      "repos_url": "https://api.github.com/users/Copilot/repos",
      "events_url": "https://api.github.com/users/Copilot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Copilot/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "The error message \"job must be object\" is misleading when JSON parsing fails. The actual problem is that the provided string is not valid JSON, not that it isn't an object. Consider a more specific error message like \"job: invalid JSON string\" or \"job must be a valid JSON object or object\" to better indicate what went wrong.\n```suggestion\n              throw new Error(\"job: invalid JSON string\");\n```",
    "created_at": "2026-01-26T04:34:23Z",
    "updated_at": "2026-01-26T04:34:24Z",
    "html_url": "https://github.com/openclaw/openclaw/pull/2071#discussion_r2726325539",
    "pull_request_url": "https://api.github.com/repos/openclaw/openclaw/pulls/2071",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2726325539"
      },
      "html": {
        "href": "https://github.com/openclaw/openclaw/pull/2071#discussion_r2726325539"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/openclaw/openclaw/pulls/2071"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2726325539/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 166,
    "original_line": 166,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 26,
    "position": 186,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2726325551",
    "pull_request_review_id": 3704617574,
    "id": 2726325551,
    "node_id": "PRRC_kwDOQb6kR86igG0v",
    "diff_hunk": "@@ -89,6 +89,33 @@ describe(\"cron tool\", () => {\n     });\n   });\n \n+  it(\"accepts cron.add job payloads as JSON strings\", async () => {\n+    const tool = createCronTool();\n+    const jobJson = JSON.stringify({\n+      name: \"wake-up\",\n+      schedule: { atMs: 123 },\n+      payload: { kind: \"systemEvent\", text: \"hello\" },\n+    });\n+    await tool.execute(\"call-json\", {\n+      action: \"add\",\n+      job: jobJson,\n+    });\n+\n+    expect(callGatewayMock).toHaveBeenCalledTimes(1);\n+    const call = callGatewayMock.mock.calls[0]?.[0] as {\n+      method?: string;\n+      params?: unknown;\n+    };\n+    expect(call.method).toBe(\"cron.add\");\n+    expect(call.params).toEqual({\n+      name: \"wake-up\",\n+      schedule: { kind: \"at\", atMs: 123 },\n+      sessionTarget: \"main\",\n+      wakeMode: \"next-heartbeat\",\n+      payload: { kind: \"systemEvent\", text: \"hello\" },\n+    });\n+  });",
    "path": "src/agents/tools/cron-tool.test.ts",
    "commit_id": "b856c154851755b55365c7ad193d21b2588370cd",
    "original_commit_id": "b856c154851755b55365c7ad193d21b2588370cd",
    "user": {
      "login": "Copilot",
      "id": 175728472,
      "node_id": "BOT_kgDOCnlnWA",
      "avatar_url": "https://avatars.githubusercontent.com/in/946600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Copilot",
      "html_url": "https://github.com/apps/copilot-pull-request-reviewer",
      "followers_url": "https://api.github.com/users/Copilot/followers",
      "following_url": "https://api.github.com/users/Copilot/following{/other_user}",
      "gists_url": "https://api.github.com/users/Copilot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Copilot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Copilot/subscriptions",
      "organizations_url": "https://api.github.com/users/Copilot/orgs",
      "repos_url": "https://api.github.com/users/Copilot/repos",
      "events_url": "https://api.github.com/users/Copilot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Copilot/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "Consider adding test coverage for edge cases such as: JSON strings that parse to arrays (e.g., `JSON.stringify([...])`), primitives (e.g., `\"123\"`, `\"true\"`), and invalid JSON (e.g., `\"{invalid}\"`). While the code correctly handles these cases with appropriate error messages, explicit tests would ensure this behavior is maintained and document the expected error handling.",
    "created_at": "2026-01-26T04:34:23Z",
    "updated_at": "2026-01-26T04:34:24Z",
    "html_url": "https://github.com/openclaw/openclaw/pull/2071#discussion_r2726325551",
    "pull_request_url": "https://api.github.com/repos/openclaw/openclaw/pulls/2071",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2726325551"
      },
      "html": {
        "href": "https://github.com/openclaw/openclaw/pull/2071#discussion_r2726325551"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/openclaw/openclaw/pulls/2071"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2726325551/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 92,
    "original_start_line": 92,
    "start_side": "RIGHT",
    "line": 117,
    "original_line": 117,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 29,
    "position": 1,
    "subject_type": "line"
  }
]
