{
  "url": "https://api.github.com/repos/openclaw/openclaw/issues/11013",
  "repository_url": "https://api.github.com/repos/openclaw/openclaw",
  "labels_url": "https://api.github.com/repos/openclaw/openclaw/issues/11013/labels{/name}",
  "comments_url": "https://api.github.com/repos/openclaw/openclaw/issues/11013/comments",
  "events_url": "https://api.github.com/repos/openclaw/openclaw/issues/11013/events",
  "html_url": "https://github.com/openclaw/openclaw/issues/11013",
  "id": 3909812850,
  "node_id": "I_kwDOQb6kR87pCwJy",
  "number": 11013,
  "title": "Cron scheduler auto-dispatch stalls after SIGUSR1 restart — jobs never fire despite scheduler reporting 'started'",
  "user": {
    "login": "Proxify",
    "id": 5466312,
    "node_id": "MDQ6VXNlcjU0NjYzMTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5466312?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Proxify",
    "html_url": "https://github.com/Proxify",
    "followers_url": "https://api.github.com/users/Proxify/followers",
    "following_url": "https://api.github.com/users/Proxify/following{/other_user}",
    "gists_url": "https://api.github.com/users/Proxify/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Proxify/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Proxify/subscriptions",
    "organizations_url": "https://api.github.com/users/Proxify/orgs",
    "repos_url": "https://api.github.com/users/Proxify/repos",
    "events_url": "https://api.github.com/users/Proxify/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Proxify/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 1,
  "created_at": "2026-02-07T08:45:13Z",
  "updated_at": "2026-02-08T03:50:06Z",
  "closed_at": "2026-02-08T03:50:06Z",
  "author_association": "NONE",
  "type": null,
  "active_lock_reason": null,
  "sub_issues_summary": {
    "total": 0,
    "completed": 0,
    "percent_completed": 0
  },
  "issue_dependencies_summary": {
    "blocked_by": 0,
    "total_blocked_by": 0,
    "blocking": 0,
    "total_blocking": 0
  },
  "body": "## Bug Description\n\nAfter a Gateway SIGUSR1 restart (triggered by a config change), the cron scheduler stops dispatching jobs automatically. The scheduler reports itself as `\"started\"` and advances `nextWakeAtMs` correctly, but **never actually spawns isolated sessions to execute due jobs**.\n\n## Environment\n\n- **OpenClaw version**: `2026.2.3-1`\n- **OS**: WSL2 Ubuntu 24.04 on Windows\n- **Node.js**: v22.22.0\n- **Runtime**: systemd user service (`openclaw-gateway.service`)\n\n## Steps to Reproduce\n\n1. Have multiple recurring cron jobs configured (mix of `every` and `cron` schedules, all `sessionTarget: \"isolated\"`)\n2. Trigger a Gateway SIGUSR1 restart (e.g., via `gateway(action=\"restart\")` tool call or config change)\n3. Observe that cron jobs stop firing after the restart\n\n## Expected Behavior\n\nAfter a SIGUSR1 restart, the cron scheduler should re-arm all timers and dispatch jobs when their `nextRunAtMs` is reached.\n\n## Actual Behavior\n\n- `cron(action=\"status\")` reports `{ enabled: true, jobs: 11, nextWakeAtMs: <future timestamp> }` — looks healthy\n- `nextWakeAtMs` **advances** past job fire times — the scheduler tick is running\n- But **zero isolated sessions are spawned** — no `cron:<jobId>` sessions appear in `sessions_list`\n- `cron(action=\"runs\")` shows no new entries after the restart\n- No `dispatch`, `spawn`, `agentTurn`, or `isolated` log entries appear in Gateway logs\n- Gateway logs only show `cron: started` at boot — no subsequent dispatch activity\n\n## Attempted Fixes (all failed to restore auto-dispatch)\n\n1. **SIGUSR1 restart** via `gateway(action=\"restart\")` — scheduler re-initializes but still doesn't dispatch\n2. **Full process restart** via `systemctl --user restart openclaw-gateway.service` — new PID, scheduler says \"started\", still doesn't dispatch\n3. **`cron(action=\"wake\", mode=\"now\")`** — returns `{ ok: true }` but no jobs fire\n4. **Manually resetting `nextRunAtMs`** in `jobs.json` to past timestamps — scheduler recalculates forward from interval on restart, still doesn't dispatch\n5. **Clearing `lastRunAtMs` and `lastStatus`** from all job state — same result\n\n## Workaround That Works\n\n**`openclaw cron run <jobId> --force`** successfully executes jobs. The execution pipeline itself is fine — only the automatic timer-based dispatch is broken.\n\nCurrent workaround: system crontab entries that call `openclaw cron run <jobId> --force` on each job's interval.\n\n## Timeline\n\n- **Feb 5, 2:58 PM CT**: Last successful automatic cron dispatch (Kalshi scanner job)\n- **Feb 5, 4:43 PM CT**: Gateway SIGUSR1 restart triggered by config change (block streaming + TTS settings)\n- **Feb 5, 4:43 PM CT → Feb 7, 2:30 AM CT**: ~35 hours of zero automatic dispatches across all 11 jobs\n- **Feb 6, 11:47 PM CT**: Another session detected the stall and attempted SIGUSR1 restart — didn't fix it\n- **Feb 7, 2:04 AM CT**: Full systemctl restart — didn't fix auto-dispatch\n- **Feb 7, 2:30 AM CT**: `openclaw cron run --force` confirmed jobs can execute manually\n\n## Key Observation\n\nThe `wakeMode` on all jobs is `\"next-heartbeat\"`. The heartbeat subsystem IS running (5 min interval, confirmed in logs). But the cron dispatcher doesn't appear to check for due jobs during heartbeat ticks — or the check silently fails/skips.\n\n## Relevant Log Entries\n\n```\n# Cron says \"started\" after restart but never dispatches:\n{\"module\":\"cron\"} {\"enabled\":true,\"jobs\":11,\"nextWakeAtMs\":1770452046127} \"cron: started\"\n\n# Heartbeat running fine:\n{\"subsystem\":\"gateway/heartbeat\"} {\"intervalMs\":300000} \"heartbeat: started\"\n\n# Zero entries matching: dispatch, spawn, agentTurn, isolated, fire, tick\ngrep -c \"dispatch\\|spawn\\|agentTurn\\|isolated\" /tmp/openclaw/openclaw-2026-02-07.log\n# Result: 0\n```\n\n## Job Store Path\n\n`~/.openclaw/cron/jobs.json` — 11 jobs, all `enabled: true`, mix of `schedule.kind: \"every\"` (5m, 15m, 60m, 180m, 360m) and `schedule.kind: \"cron\"`.\n\n## Suggested Investigation\n\nThe scheduler tick advances `nextWakeAtMs` but the dispatch codepath that should compare `nextRunAtMs` against `Date.now()` and spawn isolated sessions appears to be silently broken after SIGUSR1. Possibly a stale reference to the old scheduler instance, or the dispatch callback isn't re-registered on the new timer.\n",
  "closed_by": {
    "login": "tyler6204",
    "id": 64381258,
    "node_id": "MDQ6VXNlcjY0MzgxMjU4",
    "avatar_url": "https://avatars.githubusercontent.com/u/64381258?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tyler6204",
    "html_url": "https://github.com/tyler6204",
    "followers_url": "https://api.github.com/users/tyler6204/followers",
    "following_url": "https://api.github.com/users/tyler6204/following{/other_user}",
    "gists_url": "https://api.github.com/users/tyler6204/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tyler6204/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tyler6204/subscriptions",
    "organizations_url": "https://api.github.com/users/tyler6204/orgs",
    "repos_url": "https://api.github.com/users/tyler6204/repos",
    "events_url": "https://api.github.com/users/tyler6204/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tyler6204/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/openclaw/openclaw/issues/11013/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/openclaw/openclaw/issues/11013/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed",
  "pinned_comment": null
}
