{
  "url": "https://api.github.com/repos/openclaw/openclaw/issues/10564",
  "repository_url": "https://api.github.com/repos/openclaw/openclaw",
  "labels_url": "https://api.github.com/repos/openclaw/openclaw/issues/10564/labels{/name}",
  "comments_url": "https://api.github.com/repos/openclaw/openclaw/issues/10564/comments",
  "events_url": "https://api.github.com/repos/openclaw/openclaw/issues/10564/events",
  "html_url": "https://github.com/openclaw/openclaw/issues/10564",
  "id": 3907756303,
  "node_id": "I_kwDOQb6kR87o66EP",
  "number": 10564,
  "title": "Cron scheduler stuck with stale nextWakeAtMs after gateway restarts — misses all scheduled slots until external API call",
  "user": {
    "login": "zhiyuanw101",
    "id": 31650641,
    "node_id": "MDQ6VXNlcjMxNjUwNjQx",
    "avatar_url": "https://avatars.githubusercontent.com/u/31650641?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zhiyuanw101",
    "html_url": "https://github.com/zhiyuanw101",
    "followers_url": "https://api.github.com/users/zhiyuanw101/followers",
    "following_url": "https://api.github.com/users/zhiyuanw101/following{/other_user}",
    "gists_url": "https://api.github.com/users/zhiyuanw101/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zhiyuanw101/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zhiyuanw101/subscriptions",
    "organizations_url": "https://api.github.com/users/zhiyuanw101/orgs",
    "repos_url": "https://api.github.com/users/zhiyuanw101/repos",
    "events_url": "https://api.github.com/users/zhiyuanw101/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zhiyuanw101/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 1,
  "created_at": "2026-02-06T17:32:52Z",
  "updated_at": "2026-02-07T02:05:25Z",
  "closed_at": "2026-02-07T02:05:25Z",
  "author_association": "NONE",
  "type": null,
  "active_lock_reason": null,
  "sub_issues_summary": {
    "total": 0,
    "completed": 0,
    "percent_completed": 0
  },
  "issue_dependencies_summary": {
    "blocked_by": 0,
    "total_blocked_by": 0,
    "blocking": 0,
    "total_blocking": 0
  },
  "body": "## Bug Description\n\nAfter multiple gateway restarts (triggered by config hot-reload via SIGUSR1), the cron scheduler sets a `nextWakeAtMs` timestamp that is already in the past. It then **never self-corrects** — all subsequent scheduled slots are silently missed until an external cron API call (e.g. `cron list`) forces a recalculation.\n\n## Environment\n- **OS:** macOS 14 (arm64)\n- **Node:** v25.5.0\n- **OpenClaw:** latest (installed via npm)\n- **Cron job:** `0 7-19 * * 1-5` (hourly 7am–7pm PST, weekdays)\n- **Session target:** isolated agentTurn\n\n## Steps to Reproduce\n\n1. Have a cron job with schedule `0 7-19 * * 1-5` (tz: America/Los_Angeles)\n2. Edit workspace files multiple times between 12:00–1:00 AM PST, triggering gateway config hot-reload (SIGUSR1 restarts)\n3. Gateway restarts ~8 times between 12:14–12:48 AM\n4. After final restart, cron module logs: `nextWakeAtMs: 1770368400000` → **1:00 AM PST** (already in the past, and outside the 7-19 schedule window)\n5. Gateway stabilizes and stays running from 12:48 AM onward\n6. Mac stays awake (process keeping it alive)\n7. **7:00 AM, 8:00 AM, 9:00 AM slots are all silently missed** — zero cron activity in logs\n8. Only `TypeError: fetch failed` (non-fatal, unrelated) appears during 7-9 AM window\n9. At 9:12 AM, a manual `cron list` API call is made\n10. Scheduler recalculates `nextWakeAtMs` to `1770400800000` → **10:00 AM PST** (correct next slot)\n\n## Expected Behavior\n\nThe cron scheduler should:\n- Detect stale `nextWakeAtMs` on startup/restart and recalculate to the next valid future slot\n- Have a periodic self-check timer that catches missed slots\n- Not require an external API call to \"unstick\" itself\n\n## Relevant Log Entries\n\n```\n# Multiple restarts between 08:14–08:48 UTC (12:14–12:48 AM PST)\ncron: started  {enabled:true, jobs:2, nextWakeAtMs:1770368400000}  # 1:00 AM PST — already past!\ncron: started  {enabled:true, jobs:2, nextWakeAtMs:1770368400000}  # same stale value\n# ... repeated 8 times\n\n# 15:00–17:00 UTC (7–9 AM PST): ZERO cron activity\n# Only non-fatal fetch errors appear\n\n# 17:12 UTC (9:12 AM PST): External cron API call triggers recalculation\n# nextWakeAtMs jumps to 1770400800000 (10:00 AM PST) ✅\n```\n\n## Impact\n\nCron jobs silently fail to fire for hours after gateway restarts. Users have no indication anything is wrong until they manually check.",
  "closed_by": {
    "login": "tyler6204",
    "id": 64381258,
    "node_id": "MDQ6VXNlcjY0MzgxMjU4",
    "avatar_url": "https://avatars.githubusercontent.com/u/64381258?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tyler6204",
    "html_url": "https://github.com/tyler6204",
    "followers_url": "https://api.github.com/users/tyler6204/followers",
    "following_url": "https://api.github.com/users/tyler6204/following{/other_user}",
    "gists_url": "https://api.github.com/users/tyler6204/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tyler6204/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tyler6204/subscriptions",
    "organizations_url": "https://api.github.com/users/tyler6204/orgs",
    "repos_url": "https://api.github.com/users/tyler6204/repos",
    "events_url": "https://api.github.com/users/tyler6204/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tyler6204/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/openclaw/openclaw/issues/10564/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/openclaw/openclaw/issues/10564/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed",
  "pinned_comment": null
}
