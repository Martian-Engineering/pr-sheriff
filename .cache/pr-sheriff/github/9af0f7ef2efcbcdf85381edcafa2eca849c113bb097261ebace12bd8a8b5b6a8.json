[
  {
    "url": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2776782828",
    "pull_request_review_id": 3765979309,
    "id": 2776782828,
    "node_id": "PRRC_kwDOQb6kR86lglfs",
    "diff_hunk": "@@ -419,10 +419,13 @@ export function createSessionStatusTool(opts?: {\n \n       const userTimezone = resolveUserTimezone(cfg.agents?.defaults?.userTimezone);\n       const userTimeFormat = resolveUserTimeFormat(cfg.agents?.defaults?.timeFormat);\n-      const userTime = formatUserTime(new Date(), userTimezone, userTimeFormat);\n+      const now = new Date();\n+      const userTime = formatUserTime(now, userTimezone, userTimeFormat);\n+      const iso = now.toISOString();\n+      const unix = Math.floor(now.getTime() / 1000);\n       const timeLine = userTime",
    "path": "src/agents/tools/session-status-tool.ts",
    "commit_id": "e2c014fbe90eae889144b6ee580e76ef45d34d9c",
    "original_commit_id": "d238368550efa7bcc4a0a4daae203d3e81acb3f5",
    "user": {
      "login": "greptile-apps[bot]",
      "id": 165735046,
      "node_id": "BOT_kgDOCeDqhg",
      "avatar_url": "https://avatars.githubusercontent.com/in/867647?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/greptile-apps%5Bbot%5D",
      "html_url": "https://github.com/apps/greptile-apps",
      "followers_url": "https://api.github.com/users/greptile-apps%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/greptile-apps%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/greptile-apps%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/greptile-apps%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/greptile-apps%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/greptile-apps%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/greptile-apps%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/greptile-apps%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/greptile-apps%5Bbot%5D/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "**Unstable seconds length**\n\nThe test asserts `Unix: \\d{10}`, but the implementation uses `Math.floor(now.getTime() / 1000)` which will produce **11+ digits** for timestamps after year 2286. This makes the tool output future-incompatible and will break tests/consumers once the epoch seconds exceed 10 digits.\n\nSuggestion: don’t hardcode the digit length in tests and treat Unix timestamps as an unbounded integer (e.g. match `Unix: \\d+`).\n\n<details><summary>Prompt To Fix With AI</summary>\n\n`````markdown\nThis is a comment left during a code review.\nPath: src/agents/tools/session-status-tool.ts\nLine: 424:426\n\nComment:\n**Unstable seconds length**\n\nThe test asserts `Unix: \\d{10}`, but the implementation uses `Math.floor(now.getTime() / 1000)` which will produce **11+ digits** for timestamps after year 2286. This makes the tool output future-incompatible and will break tests/consumers once the epoch seconds exceed 10 digits.\n\nSuggestion: don’t hardcode the digit length in tests and treat Unix timestamps as an unbounded integer (e.g. match `Unix: \\d+`).\n\nHow can I resolve this? If you propose a fix, please make it concise.\n`````\n</details>",
    "created_at": "2026-02-07T02:41:23Z",
    "updated_at": "2026-02-07T02:41:25Z",
    "html_url": "https://github.com/openclaw/openclaw/pull/10836#discussion_r2776782828",
    "pull_request_url": "https://api.github.com/repos/openclaw/openclaw/pulls/10836",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2776782828"
      },
      "html": {
        "href": "https://github.com/openclaw/openclaw/pull/10836#discussion_r2776782828"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/openclaw/openclaw/pulls/10836"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2776782828/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 424,
    "original_start_line": 424,
    "start_side": "RIGHT",
    "line": 426,
    "original_line": 426,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 9,
    "position": 9,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2776782860",
    "pull_request_review_id": 3765979309,
    "id": 2776782860,
    "node_id": "PRRC_kwDOQb6kR86lglgM",
    "diff_hunk": "@@ -106,6 +106,33 @@ describe(\"session_status tool\", () => {\n     expect(details.statusText).not.toContain(\"OAuth/token status\");\n   });\n \n+  it(\"includes ISO-8601 and Unix timestamps for scheduling\", async () => {\n+    loadSessionStoreMock.mockReset();\n+    updateSessionStoreMock.mockReset();\n+    loadSessionStoreMock.mockReturnValue({\n+      main: {\n+        sessionId: \"s1\",\n+        updatedAt: 10,\n+      },\n+    });\n+\n+    const tool = createOpenClawTools({ agentSessionKey: \"main\" }).find(\n+      (candidate) => candidate.name === \"session_status\",\n+    );\n+    expect(tool).toBeDefined();\n+    if (!tool) {\n+      throw new Error(\"missing session_status tool\");\n+    }\n+\n+    const result = await tool.execute(\"call-time\", {});\n+    const details = result.details as { ok?: boolean; statusText?: string };\n+    expect(details.ok).toBe(true);\n+    // ISO-8601 format: YYYY-MM-DDTHH:MM:SS.sssZ\n+    expect(details.statusText).toMatch(/ISO-8601: \\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z/);\n+    // Unix timestamp: 10-digit number\n+    expect(details.statusText).toMatch(/Unix: \\d{10}/);",
    "path": "src/agents/openclaw-tools.session-status.test.ts",
    "commit_id": "d238368550efa7bcc4a0a4daae203d3e81acb3f5",
    "original_commit_id": "d238368550efa7bcc4a0a4daae203d3e81acb3f5",
    "user": {
      "login": "greptile-apps[bot]",
      "id": 165735046,
      "node_id": "BOT_kgDOCeDqhg",
      "avatar_url": "https://avatars.githubusercontent.com/in/867647?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/greptile-apps%5Bbot%5D",
      "html_url": "https://github.com/apps/greptile-apps",
      "followers_url": "https://api.github.com/users/greptile-apps%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/greptile-apps%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/greptile-apps%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/greptile-apps%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/greptile-apps%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/greptile-apps%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/greptile-apps%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/greptile-apps%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/greptile-apps%5Bbot%5D/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "**Overly strict Unix test**\n\nThis test hardcodes Unix seconds to `\\d{10}` (`expect(details.statusText).toMatch(/Unix: \\d{10}/)`), but Unix timestamps will exceed 10 digits in the future. To avoid making the test (and implied contract) brittle, match a generic integer instead (e.g. `/Unix: \\d+/`).\n\n<details><summary>Prompt To Fix With AI</summary>\n\n`````markdown\nThis is a comment left during a code review.\nPath: src/agents/openclaw-tools.session-status.test.ts\nLine: 131:133\n\nComment:\n**Overly strict Unix test**\n\nThis test hardcodes Unix seconds to `\\d{10}` (`expect(details.statusText).toMatch(/Unix: \\d{10}/)`), but Unix timestamps will exceed 10 digits in the future. To avoid making the test (and implied contract) brittle, match a generic integer instead (e.g. `/Unix: \\d+/`).\n\nHow can I resolve this? If you propose a fix, please make it concise.\n`````\n</details>",
    "created_at": "2026-02-07T02:41:24Z",
    "updated_at": "2026-02-07T02:41:25Z",
    "html_url": "https://github.com/openclaw/openclaw/pull/10836#discussion_r2776782860",
    "pull_request_url": "https://api.github.com/repos/openclaw/openclaw/pulls/10836",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2776782860"
      },
      "html": {
        "href": "https://github.com/openclaw/openclaw/pull/10836#discussion_r2776782860"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/openclaw/openclaw/pulls/10836"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2776782860/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 131,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 133,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 28,
    "position": 1,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2776928544",
    "pull_request_review_id": 3766146302,
    "id": 2776928544,
    "node_id": "PRRC_kwDOQb6kR86lhJEg",
    "diff_hunk": "@@ -419,10 +419,13 @@ export function createSessionStatusTool(opts?: {\n \n       const userTimezone = resolveUserTimezone(cfg.agents?.defaults?.userTimezone);\n       const userTimeFormat = resolveUserTimeFormat(cfg.agents?.defaults?.timeFormat);\n-      const userTime = formatUserTime(new Date(), userTimezone, userTimeFormat);\n+      const now = new Date();\n+      const userTime = formatUserTime(now, userTimezone, userTimeFormat);\n+      const iso = now.toISOString();\n+      const unix = Math.floor(now.getTime() / 1000);\n       const timeLine = userTime",
    "path": "src/agents/tools/session-status-tool.ts",
    "commit_id": "e2c014fbe90eae889144b6ee580e76ef45d34d9c",
    "original_commit_id": "d238368550efa7bcc4a0a4daae203d3e81acb3f5",
    "user": {
      "login": "HenryLoenwind",
      "id": 1485873,
      "node_id": "MDQ6VXNlcjE0ODU4NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1485873?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/HenryLoenwind",
      "html_url": "https://github.com/HenryLoenwind",
      "followers_url": "https://api.github.com/users/HenryLoenwind/followers",
      "following_url": "https://api.github.com/users/HenryLoenwind/following{/other_user}",
      "gists_url": "https://api.github.com/users/HenryLoenwind/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/HenryLoenwind/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/HenryLoenwind/subscriptions",
      "organizations_url": "https://api.github.com/users/HenryLoenwind/orgs",
      "repos_url": "https://api.github.com/users/HenryLoenwind/repos",
      "events_url": "https://api.github.com/users/HenryLoenwind/events{/privacy}",
      "received_events_url": "https://api.github.com/users/HenryLoenwind/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "This is unreasonable. If the test runs before 2001-09-09 01:46:40 UTC, then someone has invented a time machine and we're all doomed anyway. If it runs after 2286-11-20 17:46:39 UTC, there's also something fundamentally wrong, as that code would have stayed unchanged for 150 years.\r\n\r\nErgo, a 1-9 or 11+ digit timestamp indicates that something is wrong---exactly what a test is there to check for. I would even go so far as to check if the timestamp is between 2026-02-01 and 2036-01-31. A result outside that generous 10-year range likely (future) or definitely (past) indicates an error.",
    "created_at": "2026-02-07T03:37:16Z",
    "updated_at": "2026-02-07T03:37:17Z",
    "html_url": "https://github.com/openclaw/openclaw/pull/10836#discussion_r2776928544",
    "pull_request_url": "https://api.github.com/repos/openclaw/openclaw/pulls/10836",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2776928544"
      },
      "html": {
        "href": "https://github.com/openclaw/openclaw/pull/10836#discussion_r2776928544"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/openclaw/openclaw/pulls/10836"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2776928544/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 424,
    "original_start_line": 424,
    "start_side": "RIGHT",
    "line": 426,
    "original_line": 426,
    "side": "RIGHT",
    "in_reply_to_id": 2776782828,
    "author_association": "NONE",
    "original_position": 9,
    "position": 9,
    "subject_type": "line"
  }
]
