{
  "url": "https://api.github.com/repos/openclaw/openclaw/issues/11039",
  "repository_url": "https://api.github.com/repos/openclaw/openclaw",
  "labels_url": "https://api.github.com/repos/openclaw/openclaw/issues/11039/labels{/name}",
  "comments_url": "https://api.github.com/repos/openclaw/openclaw/issues/11039/comments",
  "events_url": "https://api.github.com/repos/openclaw/openclaw/issues/11039/events",
  "html_url": "https://github.com/openclaw/openclaw/issues/11039",
  "id": 3909896312,
  "node_id": "I_kwDOQb6kR87pDEh4",
  "number": 11039,
  "title": "Telegram: cron announce sends invalid message_thread_id in private chats",
  "user": {
    "login": "kdsz001",
    "id": 68192606,
    "node_id": "MDQ6VXNlcjY4MTkyNjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/68192606?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kdsz001",
    "html_url": "https://github.com/kdsz001",
    "followers_url": "https://api.github.com/users/kdsz001/followers",
    "following_url": "https://api.github.com/users/kdsz001/following{/other_user}",
    "gists_url": "https://api.github.com/users/kdsz001/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kdsz001/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kdsz001/subscriptions",
    "organizations_url": "https://api.github.com/users/kdsz001/orgs",
    "repos_url": "https://api.github.com/users/kdsz001/repos",
    "events_url": "https://api.github.com/users/kdsz001/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kdsz001/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 1,
  "created_at": "2026-02-07T09:43:23Z",
  "updated_at": "2026-02-08T03:49:55Z",
  "closed_at": "2026-02-08T03:49:55Z",
  "author_association": "NONE",
  "type": null,
  "active_lock_reason": null,
  "sub_issues_summary": {
    "total": 0,
    "completed": 0,
    "percent_completed": 0
  },
  "issue_dependencies_summary": {
    "blocked_by": 0,
    "total_blocked_by": 0,
    "blocking": 0,
    "total_blocking": 0
  },
  "body": "### Problem\n\nCron job announce delivery fails with `message thread not found` error in **private chats** (non-forum, non-group).\n\n### Root Cause\n\nWhen a cron job runs an isolated session and announces the result back to Telegram:\n\n1. The announce system resolves the `origin` from the requester session (main session)\n2. The origin's `threadId` is populated with a **Telegram message ID** from the chat context (e.g., `4905`)\n3. In `sendTelegramMessage()` (line ~16797 of reply module), this threadId is passed to `buildTelegramThreadParams()` with **hardcoded `scope: \"forum\"`**:\n```js\nconst threadIdParams = buildTelegramThreadParams(messageThreadId != null ? {\n    id: messageThreadId,\n    scope: \"forum\"  // Always \"forum\", even for private chats!\n} : void 0);\n```\n4. Telegram API rejects `message_thread_id` in private chats â†’ `400: Bad Request: message thread not found`\n\n### Expected Behavior\n\n- Private chat messages should NOT include `message_thread_id`\n- The `scope` should reflect the actual chat type, not be hardcoded to `\"forum\"`\n\n### Affected Features\n\n- All cron jobs with `delivery.mode: \"announce\"` and `delivery.channel: \"telegram\"` fail to deliver results\n- The isolated sessions run successfully, but users never receive the announcement\n\n### Workaround\n\nNone found yet. Restarting gateway does not clear the cached origin threadId.\n\n### Environment\n\n- OpenClaw 2026.2.6\n- Telegram private chat (not a forum/group)\n- Cron jobs with isolated sessions + announce delivery\n\n### Reproduction\n\n1. Set up OpenClaw with Telegram private chat (DM)\n2. Create a cron job with `sessionTarget: \"isolated\"` and `delivery: {mode: \"announce\", channel: \"telegram\"}`\n3. Wait for the job to run\n4. Observe error: `GrammyError: Call to 'sendMessage' failed! (400: Bad Request: message thread not found)`",
  "closed_by": {
    "login": "tyler6204",
    "id": 64381258,
    "node_id": "MDQ6VXNlcjY0MzgxMjU4",
    "avatar_url": "https://avatars.githubusercontent.com/u/64381258?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tyler6204",
    "html_url": "https://github.com/tyler6204",
    "followers_url": "https://api.github.com/users/tyler6204/followers",
    "following_url": "https://api.github.com/users/tyler6204/following{/other_user}",
    "gists_url": "https://api.github.com/users/tyler6204/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tyler6204/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tyler6204/subscriptions",
    "organizations_url": "https://api.github.com/users/tyler6204/orgs",
    "repos_url": "https://api.github.com/users/tyler6204/repos",
    "events_url": "https://api.github.com/users/tyler6204/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tyler6204/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/openclaw/openclaw/issues/11039/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/openclaw/openclaw/issues/11039/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed",
  "pinned_comment": null
}
