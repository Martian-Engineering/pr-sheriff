{
  "url": "https://api.github.com/repos/openclaw/openclaw/issues/9283",
  "repository_url": "https://api.github.com/repos/openclaw/openclaw",
  "labels_url": "https://api.github.com/repos/openclaw/openclaw/issues/9283/labels{/name}",
  "comments_url": "https://api.github.com/repos/openclaw/openclaw/issues/9283/comments",
  "events_url": "https://api.github.com/repos/openclaw/openclaw/issues/9283/events",
  "html_url": "https://github.com/openclaw/openclaw/issues/9283",
  "id": 3899305478,
  "node_id": "I_kwDOQb6kR87oaq4G",
  "number": 9283,
  "title": "[Bug]: `cron.add` tool call always fails with empty/invalid `job` object — works via CLI",
  "user": {
    "login": "Displayer226",
    "id": 57525223,
    "node_id": "MDQ6VXNlcjU3NTI1MjIz",
    "avatar_url": "https://avatars.githubusercontent.com/u/57525223?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Displayer226",
    "html_url": "https://github.com/Displayer226",
    "followers_url": "https://api.github.com/users/Displayer226/followers",
    "following_url": "https://api.github.com/users/Displayer226/following{/other_user}",
    "gists_url": "https://api.github.com/users/Displayer226/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Displayer226/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Displayer226/subscriptions",
    "organizations_url": "https://api.github.com/users/Displayer226/orgs",
    "repos_url": "https://api.github.com/users/Displayer226/repos",
    "events_url": "https://api.github.com/users/Displayer226/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Displayer226/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [
    {
      "id": 9706244967,
      "node_id": "LA_kwDOQb6kR88AAAACQomLZw",
      "url": "https://api.github.com/repos/openclaw/openclaw/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 5,
  "created_at": "2026-02-05T02:41:39Z",
  "updated_at": "2026-02-10T08:58:11Z",
  "closed_at": "2026-02-07T02:06:02Z",
  "author_association": "NONE",
  "type": null,
  "active_lock_reason": null,
  "sub_issues_summary": {
    "total": 0,
    "completed": 0,
    "percent_completed": 0
  },
  "issue_dependencies_summary": {
    "blocked_by": 0,
    "total_blocked_by": 0,
    "blocking": 0,
    "total_blocking": 0
  },
  "body": "# Bug: `cron.add` tool call systematically fails due to schema mismatch & infinite retry loop\n\n## Summary\nWhat went wrong?\nThe `cron.add` tool call fails systematically due to a schema mismatch between the LLM's perception (the tool definition) and the Gateway's internal validator. The LLM (e.g., Qwen 3 Coder) attempts to send a nested `job: { ... }` object, but the Gateway validator rejects it, explicitly requiring properties (`name`, `schedule`, `sessionTarget`, `payload`) at the top level. Additionally, the Gateway/Agent fails to handle the `INVALID_REQUEST` error as a fatal exception, causing the agent to enter an infinite retry loop, which results in a continuous stream of validation errors in the logs.\n\n## Steps to reproduce\n1. Start OpenClaw Gateway (v2026.2.2-3) from a local npm build.\n2. Use an LLM agent and ask it to: *\"Create a cron job named 'test' to run 'echo hello' every day at 5am\"*.\n3. Observe the Gateway logs: the tool call is sent with a nested `job` object as per the LLM's system instructions/tool schema.\n4. The Gateway returns `errorCode=INVALID_REQUEST` with the message: `must have required property 'name'; ...`.\n5. The agent retries the call immediately, looping indefinitely every ~3 seconds with the same payload.\n\n## Expected behavior\n- The `cron.add` tool call should succeed when provided with valid parameters, aligning with the flat structure used by the CLI:\n  ```bash\n  openclaw cron add --name \"test\" --cron \"0 5 * * *\" --session main --system-event \"echo hello\"\n  ```\n- The tool definition (JSON Schema) provided to the LLM should be synchronized with the Gateway's internal validator (either both should be nested or both should be flat).\n- The agent should stop and report a fatal error upon receiving an `INVALID_REQUEST` (validation error) instead of retrying the same invalid payload.\n\n## Actual behavior\nThe tool call is rejected by the validator because it expects root-level properties instead of a nested `job` object. This triggers an infinite loop of failed tool calls, flooding the logs and preventing the task from ever finishing.\n\n## Environment\n- OpenClaw version: `2026.2.2-3 (9c5941b)`\n- Node version: `v25.5.0`\n- OS: `Linux 6.8.0-94-generic (x64)` / Ubuntu 24.04\n- Install method: Local build / npm\n- Model used: Local GPU / QWEN 3 CODER NEXT Q4_KXL\n\n## Logs or screenshots\n```\n02:18:03 info gateway/ws ⇄ res ✗ cron.add 0ms errorCode=INVALID_REQUEST errorMessage=invalid cron.add params: must have required property 'name'; must have required property 'schedule'; must have required property 'sessionTarget'; must have required property 'payload' conn=0021d9e7…2bd1 id=33fff351…dab1\n02:18:03 error [tools] cron failed: invalid cron.add params: must have required property 'name'; must have required property 'schedule'; must have required property 'sessionTarget'; must have required property 'payload'\n02:18:06 debug agent/embedded embedded run tool start: tool=cron\n02:18:06 info gateway/ws ⇄ res ✗ cron.add 0ms errorCode=INVALID_REQUEST ...\n```\n\n## Diagnosis\n- The CLI `openclaw cron add` works with flat flags (`--name`, `--cron`, `--session`, `--system-event`).\n- The tool call schema (as received by the LLM) expects nested `job: { ... }`.\n- The Gateway validator expects flat top-level fields (`name`, `schedule`, `sessionTarget`, `payload`).\n- The agent retries validation failures, causing the infinite loop.\n\n## Suggested Fix\n1. **Align tool schema with validator**  \n   Update the `cron.add` tool definition to match the Gateway's internal validator — use flat, top-level fields (`name`, `schedule`, `sessionTarget`, `payload`) instead of nested `job: { ... }`.\n\n2. **Prevent infinite retry on `INVALID_REQUEST`**  \n   Modify the agent to treat `INVALID_REQUEST` errors as terminal (no retry), since they indicate a user/tool mistake rather than a transient failure.\n\n3. **Improve error messages**  \n   When validation fails, return a working CLI equivalent in the error response so users can work around the issue:\n   ```\n   Example usage:\n   openclaw cron add --name \"test\" --cron \"0 5 * * *\" --session main --system-event \"echo hello\"\n   ```\n\n4. **Add tool call test suite**  \n   Include a test for `cron.add` to ensure the tool schema and Gateway validator stay in sync during future changes.",
  "closed_by": {
    "login": "tyler6204",
    "id": 64381258,
    "node_id": "MDQ6VXNlcjY0MzgxMjU4",
    "avatar_url": "https://avatars.githubusercontent.com/u/64381258?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tyler6204",
    "html_url": "https://github.com/tyler6204",
    "followers_url": "https://api.github.com/users/tyler6204/followers",
    "following_url": "https://api.github.com/users/tyler6204/following{/other_user}",
    "gists_url": "https://api.github.com/users/tyler6204/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tyler6204/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tyler6204/subscriptions",
    "organizations_url": "https://api.github.com/users/tyler6204/orgs",
    "repos_url": "https://api.github.com/users/tyler6204/repos",
    "events_url": "https://api.github.com/users/tyler6204/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tyler6204/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/openclaw/openclaw/issues/9283/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/openclaw/openclaw/issues/9283/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed",
  "pinned_comment": null
}
