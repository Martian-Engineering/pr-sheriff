{
  "url": "https://api.github.com/repos/openclaw/openclaw/issues/10025",
  "repository_url": "https://api.github.com/repos/openclaw/openclaw",
  "labels_url": "https://api.github.com/repos/openclaw/openclaw/issues/10025/labels{/name}",
  "comments_url": "https://api.github.com/repos/openclaw/openclaw/issues/10025/comments",
  "events_url": "https://api.github.com/repos/openclaw/openclaw/issues/10025/events",
  "html_url": "https://github.com/openclaw/openclaw/issues/10025",
  "id": 3904335603,
  "node_id": "I_kwDOQb6kR87ot27z",
  "number": 10025,
  "title": "[Bug]: Cron scheduler off-by-one-day bug after job execution (updatedAtMs trigger)",
  "user": {
    "login": "Guoyin-Wen",
    "id": 38291882,
    "node_id": "MDQ6VXNlcjM4MjkxODgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/38291882?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Guoyin-Wen",
    "html_url": "https://github.com/Guoyin-Wen",
    "followers_url": "https://api.github.com/users/Guoyin-Wen/followers",
    "following_url": "https://api.github.com/users/Guoyin-Wen/following{/other_user}",
    "gists_url": "https://api.github.com/users/Guoyin-Wen/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Guoyin-Wen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Guoyin-Wen/subscriptions",
    "organizations_url": "https://api.github.com/users/Guoyin-Wen/orgs",
    "repos_url": "https://api.github.com/users/Guoyin-Wen/repos",
    "events_url": "https://api.github.com/users/Guoyin-Wen/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Guoyin-Wen/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 1,
  "created_at": "2026-02-06T01:27:10Z",
  "updated_at": "2026-02-07T02:04:38Z",
  "closed_at": "2026-02-07T02:04:38Z",
  "author_association": "NONE",
  "type": null,
  "active_lock_reason": null,
  "sub_issues_summary": {
    "total": 0,
    "completed": 0,
    "percent_completed": 0
  },
  "issue_dependencies_summary": {
    "blocked_by": 0,
    "total_blocked_by": 0,
    "blocking": 0,
    "total_blocking": 0
  },
  "body": "\n## Summary\nCron scheduler miscalculates `nextRunAtMs` after job execution, skipping next day's scheduled run and jumping to day after (off-by-one day bug).\n\n## Steps to reproduce\n1. Create a daily cron job with schedule `\"0 9 * * *\"` (9:00 AM daily)\n2. Let the job execute on Day 1 (2026-02-05 09:00 AM)\n3. Check the job's `nextRunAtMs` in `~/.openclaw/cron/jobs.json`\n\n## Expected behavior\nAfter the job executes on Day 1 (2026-02-05 09:00 AM):\n- `nextRunAtMs` should be set to Day 2 (2026-02-06 09:00 AM)\n- Job should fire on Day 2 at 09:00 AM\n\n## Actual behavior\nAfter the job executes on Day 1 (2026-02-05 09:00 AM):\n- `nextRunAtMs` is incorrectly set to Day 3 (2026-02-07 09:00 AM)\n- Job does NOT fire on Day 2 (2026-02-06 09:00 AM)\n- Gap between `lastRunAtMs` and `nextRunAtMs` is ~48 hours instead of ~24 hours\n\n### Timeline\n- 2026-02-05 09:00 AM: Job fires successfully\n- Gateway updates `updatedAtMs` to 1770253200008 (2026-02-05 09:00:00.008)\n- Scheduler miscalculates `nextRunAtMs` as 1770426000000 (2026-02-07 09:00:00)\n- 2026-02-06 09:00 AM: Job does NOT fire (skipped) ⚠️\n- 2026-02-07 09:00 AM: Next scheduled run (48 hours later)\n\n### Observed state (jobs.json)\n```json\n{\n  \"schedule\": {\n    \"kind\": \"cron\",\n    \"expr\": \"0 9 * * *\",\n    \"tz\": \"Asia/Shanghai\"\n  },\n  \"state\": {\n    \"lastRunAtMs\": 1770253200009,  // 2026-02-05 09:00:00.009\n    \"nextRunAtMs\": 1770426000000,  // 2026-02-07 09:00:00.000  ← WRONG!\n    \"lastStatus\": \"ok\"\n  }\n}\n```\n\n### Verified timestamps\n```python\n# Expected next run:\n2026-02-06 09:00:00 CST = 1770339600000 ms\n\n# Actual next run:\n2026-02-07 09:00:00 CST = 1770426000000 ms\n\n# Gap: 86400000 ms = 24 hours (one full day skipped)\n```\n\n## Environment\n- OpenClaw version: 2026.2.3-1\n- OS: macOS 25.2.0 (arm64)\n- Node: v25.6.0\n- Gateway: Running (pid 6838), no restart on Day 1\n\n## Impact\nAny daily cron job can skip an entire day's execution after a single successful run. This causes:\n- Missed daily reports/briefings\n- Missed scheduled backups\n- Missed monitoring/alerts\n- Silent failures (no error logs, job just does not fire)\n\n## Related issues\n- #10021 - Cron scheduler skips jobs after mid-day gateway restart (similar root cause)\n- #4586 - Cron schedule update skips next scheduled run (off-by-one day) (same symptoms)\n\n## Additional context\n- Gateway did NOT restart between Day 1 and Day 2 (verified via logs)\n- The `updatedAtMs` field was updated by Gateway after job execution (1770253200008)\n- This update may trigger the same scheduling bug as described in #10021 and #4586\n- No cron execution logs for Day 2 at 09:00 AM\n- Manual run attempt failed with \"not-due\" error (scheduler thinks next run is Day 3)\n",
  "closed_by": {
    "login": "tyler6204",
    "id": 64381258,
    "node_id": "MDQ6VXNlcjY0MzgxMjU4",
    "avatar_url": "https://avatars.githubusercontent.com/u/64381258?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tyler6204",
    "html_url": "https://github.com/tyler6204",
    "followers_url": "https://api.github.com/users/tyler6204/followers",
    "following_url": "https://api.github.com/users/tyler6204/following{/other_user}",
    "gists_url": "https://api.github.com/users/tyler6204/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tyler6204/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tyler6204/subscriptions",
    "organizations_url": "https://api.github.com/users/tyler6204/orgs",
    "repos_url": "https://api.github.com/users/tyler6204/repos",
    "events_url": "https://api.github.com/users/tyler6204/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tyler6204/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/openclaw/openclaw/issues/10025/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/openclaw/openclaw/issues/10025/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed",
  "pinned_comment": null
}
