{
  "url": "https://api.github.com/repos/openclaw/openclaw/issues/10702",
  "repository_url": "https://api.github.com/repos/openclaw/openclaw",
  "labels_url": "https://api.github.com/repos/openclaw/openclaw/issues/10702/labels{/name}",
  "comments_url": "https://api.github.com/repos/openclaw/openclaw/issues/10702/comments",
  "events_url": "https://api.github.com/repos/openclaw/openclaw/issues/10702/events",
  "html_url": "https://github.com/openclaw/openclaw/issues/10702",
  "id": 3908493804,
  "node_id": "I_kwDOQb6kR87o9uHs",
  "number": 10702,
  "title": "Cron scheduler timer never fires after gateway startup (v2026.2.3)",
  "user": {
    "login": "troyhoffman-oss",
    "id": 253635405,
    "node_id": "U_kgDODx4rTQ",
    "avatar_url": "https://avatars.githubusercontent.com/u/253635405?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/troyhoffman-oss",
    "html_url": "https://github.com/troyhoffman-oss",
    "followers_url": "https://api.github.com/users/troyhoffman-oss/followers",
    "following_url": "https://api.github.com/users/troyhoffman-oss/following{/other_user}",
    "gists_url": "https://api.github.com/users/troyhoffman-oss/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/troyhoffman-oss/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/troyhoffman-oss/subscriptions",
    "organizations_url": "https://api.github.com/users/troyhoffman-oss/orgs",
    "repos_url": "https://api.github.com/users/troyhoffman-oss/repos",
    "events_url": "https://api.github.com/users/troyhoffman-oss/events{/privacy}",
    "received_events_url": "https://api.github.com/users/troyhoffman-oss/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 6,
  "created_at": "2026-02-06T21:32:24Z",
  "updated_at": "2026-02-09T07:18:36Z",
  "closed_at": "2026-02-07T02:06:57Z",
  "author_association": "NONE",
  "type": null,
  "active_lock_reason": null,
  "sub_issues_summary": {
    "total": 0,
    "completed": 0,
    "percent_completed": 0
  },
  "issue_dependencies_summary": {
    "blocked_by": 0,
    "total_blocked_by": 0,
    "blocking": 0,
    "total_blocking": 0
  },
  "body": "## Summary\n\nAfter updating to OpenClaw `2026.2.3`, the cron scheduler's `setTimeout` timer armed during `start()` never fires. All cron jobs silently stop executing. The gateway process stays alive and handles Discord messages, but the cron tick callback never runs.\n\n## Environment\n\n- **OpenClaw version**: 2026.2.3 (upgraded from 2026.1.30)\n- **Node.js**: 22.22.0\n- **Platform**: macOS (Darwin 25.2.0, Apple Silicon)\n- **Gateway**: launchd service, port 18789\n\n## Reproduction\n\n1. Have cron jobs configured (tested with `*/15 7-23 * * *` and `0 7-21 * * *`)\n2. Update OpenClaw to 2026.2.3 via `npm install -g openclaw`\n3. Restart gateway (`openclaw gateway restart`)\n4. Observe: \"cron: started\" log with correct `nextWakeAtMs`\n5. Wait past `nextWakeAtMs` — timer never fires, no jobs execute\n6. Restart again — `recomputeNextRuns` advances `nextRunAtMs` to next future slot, prior windows silently skipped\n\n## Evidence\n\nSix gateway startups on 2026-02-06, each logging `cron: started` with correct `nextWakeAtMs`. Zero cron executions between any pair of startups:\n\n| Startup Time (CT) | `nextWakeAtMs` target | Timer fired? |\n|---|---|---|\n| 10:32 (old code CHghbhEZ) | 10:45 | No — restarted at 11:05 |\n| 11:05 (new code CqYA0Lb3) | 11:15 | No — restarted at 11:18 |\n| 11:18 | 11:30 | **No — 83 min silence, process alive** |\n| 12:41 (SIGUSR1) | 12:45 | No — config reload at 12:42 |\n| 12:42 (config reload) | 12:45 | **No — 3+ hours silence, process alive** |\n\n- `lastRunAtMs` for all cron jobs is frozen at pre-update timestamps (10:00 and 10:30 CT)\n- Process is alive during gaps — handles Discord messages, WebSocket reconnects\n- Both SIGUSR1 hot-restarts and `launchctl load` cold starts exhibit the behavior\n\n## Affected Code Path\n\nIn `gateway-cli-CqYA0Lb3.js`, the `armTimer()` function:\n\n```javascript\nfunction armTimer(state) {\n  if (state.timer) clearTimeout(state.timer);\n  state.timer = null;\n  if (!state.deps.cronEnabled) return;\n  const nextAt = nextWakeAtMs(state);\n  if (!nextAt) return;\n  const delay = Math.max(nextAt - state.deps.nowMs(), 0);\n  const clampedDelay = Math.min(delay, MAX_TIMEOUT_MS);\n  state.timer = setTimeout(() => {\n    onTimer(state).catch((err) => {\n      state.deps.log.error({ err: String(err) }, \"cron: timer tick failed\");\n    });\n  }, clampedDelay);\n  state.timer.unref?.();\n}\n```\n\nTimer is armed with correct delay, but the callback never executes. No \"cron: timer tick failed\" errors in logs either. The `start()` → `recomputeNextRuns()` → `persist()` → `armTimer()` sequence completes and logs correctly — it's only the subsequent `setTimeout` callback that silently fails.\n\n## Workaround\n\nNone found yet. Hard restart (`gateway stop` + `launchctl load`) re-arms the timer but it still doesn't fire. Testing a fresh cold start now.\n\n## Impact\n\nAll cron-scheduled jobs stop executing after update. For agents relying on cron heartbeats (e.g., every 15 minutes), this means complete loss of autonomous operation with no errors or warnings.",
  "closed_by": {
    "login": "tyler6204",
    "id": 64381258,
    "node_id": "MDQ6VXNlcjY0MzgxMjU4",
    "avatar_url": "https://avatars.githubusercontent.com/u/64381258?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tyler6204",
    "html_url": "https://github.com/tyler6204",
    "followers_url": "https://api.github.com/users/tyler6204/followers",
    "following_url": "https://api.github.com/users/tyler6204/following{/other_user}",
    "gists_url": "https://api.github.com/users/tyler6204/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tyler6204/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tyler6204/subscriptions",
    "organizations_url": "https://api.github.com/users/tyler6204/orgs",
    "repos_url": "https://api.github.com/users/tyler6204/repos",
    "events_url": "https://api.github.com/users/tyler6204/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tyler6204/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/openclaw/openclaw/issues/10702/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/openclaw/openclaw/issues/10702/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed",
  "pinned_comment": null
}
