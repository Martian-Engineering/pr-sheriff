{
  "url": "https://api.github.com/repos/openclaw/openclaw/issues/9472",
  "repository_url": "https://api.github.com/repos/openclaw/openclaw",
  "labels_url": "https://api.github.com/repos/openclaw/openclaw/issues/9472/labels{/name}",
  "comments_url": "https://api.github.com/repos/openclaw/openclaw/issues/9472/comments",
  "events_url": "https://api.github.com/repos/openclaw/openclaw/issues/9472/events",
  "html_url": "https://github.com/openclaw/openclaw/issues/9472",
  "id": 3900207271,
  "node_id": "I_kwDOQb6kR87oeHCn",
  "number": 9472,
  "title": "Bug: cron tool doesn't set state.nextRunAtMs, jobs never auto-fire",
  "user": {
    "login": "Aqelyy",
    "id": 213450146,
    "node_id": "U_kgDODLj9og",
    "avatar_url": "https://avatars.githubusercontent.com/u/213450146?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Aqelyy",
    "html_url": "https://github.com/Aqelyy",
    "followers_url": "https://api.github.com/users/Aqelyy/followers",
    "following_url": "https://api.github.com/users/Aqelyy/following{/other_user}",
    "gists_url": "https://api.github.com/users/Aqelyy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Aqelyy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Aqelyy/subscriptions",
    "organizations_url": "https://api.github.com/users/Aqelyy/orgs",
    "repos_url": "https://api.github.com/users/Aqelyy/repos",
    "events_url": "https://api.github.com/users/Aqelyy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Aqelyy/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 3,
  "created_at": "2026-02-05T07:56:59Z",
  "updated_at": "2026-02-08T03:49:57Z",
  "closed_at": "2026-02-08T03:49:57Z",
  "author_association": "NONE",
  "type": null,
  "active_lock_reason": null,
  "sub_issues_summary": {
    "total": 0,
    "completed": 0,
    "percent_completed": 0
  },
  "issue_dependencies_summary": {
    "blocked_by": 0,
    "total_blocked_by": 0,
    "blocking": 0,
    "total_blocking": 0
  },
  "body": "## Environment\n- OpenClaw version: 2026.2.1\n- OS: macOS (Darwin 25.2.0 arm64)\n- Node: v22.22.0\n\n## Description\nWhen creating cron jobs via the `cron` agent tool, the job is created but `state.nextRunAtMs` is not set, resulting in `nextWakeAtMs: null` in cron status. Jobs never auto-fire at the scheduled time.\n\n## Steps to Reproduce\n1. Use the `cron` tool to add a job:\n```json\n{\n  \"action\": \"add\",\n  \"job\": {\n    \"name\": \"Test\",\n    \"schedule\": {\"kind\": \"at\", \"atMs\": 1770272283000},\n    \"sessionTarget\": \"isolated\",\n    \"wakeMode\": \"now\",\n    \"payload\": {\"kind\": \"agentTurn\", \"message\": \"Test\", \"deliver\": true, \"channel\": \"telegram\", \"to\": \"123456\"}\n  }\n}\n```\n2. Check `cron status` â†’ `nextWakeAtMs: null`\n3. Job never fires automatically\n4. Manual `cron run <jobId> --force` works\n\n## Expected Behavior\n`state.nextRunAtMs` should be set when job is created, and job should auto-fire at scheduled time.\n\n## Workaround\nUsing CLI works correctly:\n```bash\nopenclaw cron add --name \"Test\" --at \"2m\" --session isolated --message \"Test\" --deliver --wake now\n```\nCLI creates jobs with proper `state: { nextRunAtMs: <timestamp> }` while the tool creates jobs with empty `state: {}`.\n\n## Additional Context\nDiscovered while setting up wake-up call alarms. The difference between tool and CLI behavior suggests the tool endpoint is missing the state initialization logic that the CLI has.",
  "closed_by": {
    "login": "tyler6204",
    "id": 64381258,
    "node_id": "MDQ6VXNlcjY0MzgxMjU4",
    "avatar_url": "https://avatars.githubusercontent.com/u/64381258?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tyler6204",
    "html_url": "https://github.com/tyler6204",
    "followers_url": "https://api.github.com/users/tyler6204/followers",
    "following_url": "https://api.github.com/users/tyler6204/following{/other_user}",
    "gists_url": "https://api.github.com/users/tyler6204/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tyler6204/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tyler6204/subscriptions",
    "organizations_url": "https://api.github.com/users/tyler6204/orgs",
    "repos_url": "https://api.github.com/users/tyler6204/repos",
    "events_url": "https://api.github.com/users/tyler6204/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tyler6204/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/openclaw/openclaw/issues/9472/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/openclaw/openclaw/issues/9472/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed",
  "pinned_comment": null
}
