{
  "url": "https://api.github.com/repos/openclaw/openclaw/issues/10584",
  "repository_url": "https://api.github.com/repos/openclaw/openclaw",
  "labels_url": "https://api.github.com/repos/openclaw/openclaw/issues/10584/labels{/name}",
  "comments_url": "https://api.github.com/repos/openclaw/openclaw/issues/10584/comments",
  "events_url": "https://api.github.com/repos/openclaw/openclaw/issues/10584/events",
  "html_url": "https://github.com/openclaw/openclaw/issues/10584",
  "id": 3907839616,
  "node_id": "I_kwDOQb6kR87o7OaA",
  "number": 10584,
  "title": "Bug: Cron timer stops firing after config model change (v2026.2.3-1)",
  "user": {
    "login": "alexioklini",
    "id": 1140889,
    "node_id": "MDQ6VXNlcjExNDA4ODk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1140889?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alexioklini",
    "html_url": "https://github.com/alexioklini",
    "followers_url": "https://api.github.com/users/alexioklini/followers",
    "following_url": "https://api.github.com/users/alexioklini/following{/other_user}",
    "gists_url": "https://api.github.com/users/alexioklini/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alexioklini/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alexioklini/subscriptions",
    "organizations_url": "https://api.github.com/users/alexioklini/orgs",
    "repos_url": "https://api.github.com/users/alexioklini/repos",
    "events_url": "https://api.github.com/users/alexioklini/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alexioklini/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 1,
  "created_at": "2026-02-06T17:55:45Z",
  "updated_at": "2026-02-07T02:11:19Z",
  "closed_at": "2026-02-07T02:11:19Z",
  "author_association": "NONE",
  "type": null,
  "active_lock_reason": null,
  "sub_issues_summary": {
    "total": 0,
    "completed": 0,
    "percent_completed": 0
  },
  "issue_dependencies_summary": {
    "blocked_by": 0,
    "total_blocked_by": 0,
    "blocking": 0,
    "total_blocking": 0
  },
  "body": "## Bug: Cron timer stops firing after config change (v2026.2.3-1)\n\n**Environment:** macOS Sequoia (arm64), Node 25.5.0, OpenClaw 2026.2.3-1\n\n### Description\n\nAfter changing the default model in config (from `claude-opus-4-5` to `anthropic-cloud/claude-opus-4-6`), all cron jobs stopped executing. The scheduler initializes correctly but the timer callback (`onTimer`) never fires.\n\n### Steps to Reproduce\n\n1. Have working cron jobs (isolated agentTurn, every 5min, model: `local-llm/gemini-2.5-pro`)\n2. Change `agents.defaults.model.primary` from one model to another\n3. Restart gateway (SIGUSR1 or cold restart)\n4. Observe: cron jobs never execute again\n\n### Observed Behavior\n\n- `cron: started` log entry shows correct `jobs` count and `nextWakeAtMs`\n- `cron.status` returns `enabled: true` with valid `nextWakeAtMs`\n- **No timer tick ever fires** — zero cron-related log entries after startup\n- `cron run {jobId}` returns `{ ran: false, reason: \"not-due\" }` even when `nextRunAtMs` is in the past\n- `nextRunAtMs` in `jobs.json` keeps advancing forward (gets recomputed) without execution\n- No errors in logs\n\n### What I Tried (all failed)\n\n- SIGUSR1 restart\n- Full cold restart (`launchctl bootout` + `bootstrap`)\n- Deleted ALL jobs + `runs/` directory + `jobs.json.bak`, recreated fresh\n- Both `sessionTarget: \"isolated\"` (agentTurn) and `\"main\"` (systemEvent)\n- Both `wakeMode: \"now\"` and `\"next-heartbeat\"`\n- Increased `cron.maxConcurrentRuns` to 4\n- Minimal test job: `{ schedule: { kind: \"every\", everyMs: 60000 }, payload: { kind: \"agentTurn\", message: \"Reply TEST_OK\", model: \"local-llm/gemini-2.5-pro\" } }`\n\n### Suspected Root Cause\n\nIn `onTimer()`:\n```js\nawait locked(state, async () => {\n    await ensureLoaded(state, { forceReload: true });\n    await runDueJobs(state);  // <-- never finds due jobs?\n    await persist(state);\n    armTimer(state);\n});\n```\n\n`ensureLoaded` with `forceReload: true` calls `recomputeNextRuns(state)` which recalculates all `nextRunAtMs` values to the future (via `computeNextRunAtMs(schedule, nowMs)`). By the time `runDueJobs` checks `now >= nextRunAtMs`, the values have already been pushed forward.\n\nHowever, this code path existed before and worked — so something else may be involved (possibly related to the config change invalidating internal state).\n\n### Config (relevant parts)\n\n```json\n{\n  \"agents\": {\n    \"defaults\": {\n      \"model\": {\n        \"primary\": \"anthropic-cloud/claude-opus-4-6\",\n        \"fallbacks\": [\"anthropic-cloud/claude-opus-4-5-20251101\", ...]\n      },\n      \"heartbeat\": { \"every\": \"1h\", \"model\": \"anthropic-cloud/claude-haiku-4-5-20251101\" }\n    }\n  },\n  \"cron\": { \"maxConcurrentRuns\": 4 }\n}\n```\n\n### Workaround\n\nMoved critical monitoring jobs to macOS system crontab (running Python scripts directly, no LLM needed). Daily tasks moved to HEARTBEAT.md with manual time-based checks.\n",
  "closed_by": {
    "login": "tyler6204",
    "id": 64381258,
    "node_id": "MDQ6VXNlcjY0MzgxMjU4",
    "avatar_url": "https://avatars.githubusercontent.com/u/64381258?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tyler6204",
    "html_url": "https://github.com/tyler6204",
    "followers_url": "https://api.github.com/users/tyler6204/followers",
    "following_url": "https://api.github.com/users/tyler6204/following{/other_user}",
    "gists_url": "https://api.github.com/users/tyler6204/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tyler6204/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tyler6204/subscriptions",
    "organizations_url": "https://api.github.com/users/tyler6204/orgs",
    "repos_url": "https://api.github.com/users/tyler6204/repos",
    "events_url": "https://api.github.com/users/tyler6204/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tyler6204/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/openclaw/openclaw/issues/10584/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/openclaw/openclaw/issues/10584/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed",
  "pinned_comment": null
}
