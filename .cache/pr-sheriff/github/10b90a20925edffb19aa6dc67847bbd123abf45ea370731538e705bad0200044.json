{
  "url": "https://api.github.com/repos/openclaw/openclaw/issues/10771",
  "repository_url": "https://api.github.com/repos/openclaw/openclaw",
  "labels_url": "https://api.github.com/repos/openclaw/openclaw/issues/10771/labels{/name}",
  "comments_url": "https://api.github.com/repos/openclaw/openclaw/issues/10771/comments",
  "events_url": "https://api.github.com/repos/openclaw/openclaw/issues/10771/events",
  "html_url": "https://github.com/openclaw/openclaw/issues/10771",
  "id": 3908891085,
  "node_id": "I_kwDOQb6kR87o_PHN",
  "number": 10771,
  "title": "Cron scheduler skips runs due to forceReload + recomputeNextRuns on timer tick",
  "user": {
    "login": "TechnicalParadox",
    "id": 5107397,
    "node_id": "MDQ6VXNlcjUxMDczOTc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5107397?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/TechnicalParadox",
    "html_url": "https://github.com/TechnicalParadox",
    "followers_url": "https://api.github.com/users/TechnicalParadox/followers",
    "following_url": "https://api.github.com/users/TechnicalParadox/following{/other_user}",
    "gists_url": "https://api.github.com/users/TechnicalParadox/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/TechnicalParadox/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/TechnicalParadox/subscriptions",
    "organizations_url": "https://api.github.com/users/TechnicalParadox/orgs",
    "repos_url": "https://api.github.com/users/TechnicalParadox/repos",
    "events_url": "https://api.github.com/users/TechnicalParadox/events{/privacy}",
    "received_events_url": "https://api.github.com/users/TechnicalParadox/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [],
  "milestone": null,
  "comments": 1,
  "created_at": "2026-02-07T00:02:58Z",
  "updated_at": "2026-02-07T02:06:54Z",
  "closed_at": "2026-02-07T02:06:54Z",
  "author_association": "NONE",
  "type": null,
  "active_lock_reason": null,
  "sub_issues_summary": {
    "total": 0,
    "completed": 0,
    "percent_completed": 0
  },
  "issue_dependencies_summary": {
    "blocked_by": 0,
    "total_blocked_by": 0,
    "blocking": 0,
    "total_blocking": 0
  },
  "body": "## Summary\nCron jobs with `schedule.kind=cron` can skip scheduled runs after 2026.2.3. On each timer tick, `CronService` forces a reload and recomputes `nextRunAtMs` *before* checking due jobs. `computeNextRunAtMs()` uses `Croner.nextRun(now)`, which returns the next run **after** now. If the timer fires at the scheduled boundary, `nextRunAtMs` is advanced to the next interval and `runDueJobs()` sees nothing due.\n\n## Observed\n- Hourly/30m jobs skip intervals; `nextRunAtMs` jumps ahead even though the run never executed.\n- This started after 2026.2.3 (Mac, LaunchAgent).\n\n## Root Cause (code path)\n`onTimer()` in `src/cron/service/timer.ts`:\n```ts\nawait ensureLoaded(state, { forceReload: true });\nawait runDueJobs(state);\n```\n`ensureLoaded()` calls `recomputeNextRuns()`, which calls `computeNextRunAtMs()` with `nowMs`. For cron schedules it does:\n```ts\nnew Cron(expr, { timezone }).nextRun(new Date(nowMs))\n```\nCroner `nextRun()` returns the *next* occurrence **after** `now`, so a run exactly at `now` is skipped.\n\n## Minimal Fix (works locally)\nAvoid recomputing before the due check. Example:\n```diff\n- await ensureLoaded(state, { forceReload: true });\n+ await ensureLoaded(state);\n```\n\n## Safer Alternative Fixes\n- Only force-reload/recompute when the store file mtime changes.\n- Or, in `computeNextRunAtMs()`, if `Cron(expr).match(now)` then return `now` before calling `nextRun()`.\n- Or, move `recomputeNextRuns()` to *after* `runDueJobs()` on each tick.\n\n## Notes on side effects\nRemoving the forced reload means out-of-band edits to the cron store file won’t be picked up until restart or an API call. If that’s why `forceReload` exists, a conditional reload (mtime check) would preserve that behavior without skipping runs.\n",
  "closed_by": {
    "login": "tyler6204",
    "id": 64381258,
    "node_id": "MDQ6VXNlcjY0MzgxMjU4",
    "avatar_url": "https://avatars.githubusercontent.com/u/64381258?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tyler6204",
    "html_url": "https://github.com/tyler6204",
    "followers_url": "https://api.github.com/users/tyler6204/followers",
    "following_url": "https://api.github.com/users/tyler6204/following{/other_user}",
    "gists_url": "https://api.github.com/users/tyler6204/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tyler6204/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tyler6204/subscriptions",
    "organizations_url": "https://api.github.com/users/tyler6204/orgs",
    "repos_url": "https://api.github.com/users/tyler6204/repos",
    "events_url": "https://api.github.com/users/tyler6204/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tyler6204/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/openclaw/openclaw/issues/10771/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/openclaw/openclaw/issues/10771/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed",
  "pinned_comment": null
}
