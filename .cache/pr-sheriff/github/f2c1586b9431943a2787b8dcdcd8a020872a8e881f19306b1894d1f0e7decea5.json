[
  {
    "url": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2726410464",
    "pull_request_review_id": 3704701584,
    "id": 2726410464,
    "node_id": "PRRC_kwDOQb6kR86igbjg",
    "diff_hunk": "@@ -63,15 +63,14 @@ export async function runCommandWithTimeout(\n   const { windowsVerbatimArguments } = options;\n   const hasInput = input !== undefined;\n \n-  const shouldSuppressNpmFund = (() => {\n-    const cmd = path.basename(argv[0] ?? \"\");\n-    if (cmd === \"npm\" || cmd === \"npm.cmd\" || cmd === \"npm.exe\") return true;\n-    if (cmd === \"node\" || cmd === \"node.exe\") {\n-      const script = argv[1] ?? \"\";\n-      return script.includes(\"npm-cli.js\");\n-    }\n-    return false;\n-  })();\n+  const cmd = path.basename(argv[0] ?? \"\");\n+  const isNpmCommand = cmd === \"npm\" || cmd === \"npm.cmd\" || cmd === \"npm.exe\";\n+  const isNpmViaCli =\n+    (cmd === \"node\" || cmd === \"node.exe\") && (argv[1] ?? \"\").includes(\"npm-cli.js\");\n+  const shouldSuppressNpmFund = isNpmCommand || isNpmViaCli;\n+\n+  // On Windows, npm is a .cmd batch file that requires shell mode to execute\n+  const useShell = process.platform === \"win32\" && isNpmCommand;",
    "path": "src/process/exec.ts",
    "commit_id": "2516dc78a110992b07619d1fd4c05e5761dd62ca",
    "original_commit_id": "2516dc78a110992b07619d1fd4c05e5761dd62ca",
    "user": {
      "login": "Copilot",
      "id": 175728472,
      "node_id": "BOT_kgDOCnlnWA",
      "avatar_url": "https://avatars.githubusercontent.com/in/946600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Copilot",
      "html_url": "https://github.com/apps/copilot-pull-request-reviewer",
      "followers_url": "https://api.github.com/users/Copilot/followers",
      "following_url": "https://api.github.com/users/Copilot/following{/other_user}",
      "gists_url": "https://api.github.com/users/Copilot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Copilot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Copilot/subscriptions",
      "organizations_url": "https://api.github.com/users/Copilot/orgs",
      "repos_url": "https://api.github.com/users/Copilot/repos",
      "events_url": "https://api.github.com/users/Copilot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Copilot/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "The code only enables shell mode for npm commands on Windows. However, pnpm and yarn (which are supported in skills-install.ts and update-global.ts) may also be installed as .cmd files on Windows and could encounter the same ENOENT error.\n\nConsider whether the shell mode logic should also cover pnpm and yarn commands on Windows to provide consistent behavior across package managers. The detection logic could be extended to:\n\n```\nconst isPkgManagerCommand = [\"npm\", \"npm.cmd\", \"npm.exe\", \"pnpm\", \"pnpm.cmd\", \"pnpm.exe\", \"yarn\", \"yarn.cmd\", \"yarn.exe\"].includes(cmd);\nconst useShell = process.platform === \"win32\" && isPkgManagerCommand;\n```\n\nAlternatively, if npm is the only package manager experiencing issues in practice, the current scoped fix may be preferable to minimize risk.\n```suggestion\n  const isPkgManagerCommand =\n    isNpmCommand ||\n    cmd === \"pnpm\" ||\n    cmd === \"pnpm.cmd\" ||\n    cmd === \"pnpm.exe\" ||\n    cmd === \"yarn\" ||\n    cmd === \"yarn.cmd\" ||\n    cmd === \"yarn.exe\";\n  const isNpmViaCli =\n    (cmd === \"node\" || cmd === \"node.exe\") && (argv[1] ?? \"\").includes(\"npm-cli.js\");\n  const shouldSuppressNpmFund = isNpmCommand || isNpmViaCli;\n\n  // On Windows, package managers may be .cmd batch files that require shell mode to execute\n  const useShell = process.platform === \"win32\" && isPkgManagerCommand;\n```",
    "created_at": "2026-01-26T05:47:03Z",
    "updated_at": "2026-01-26T05:47:04Z",
    "html_url": "https://github.com/openclaw/openclaw/pull/2090#discussion_r2726410464",
    "pull_request_url": "https://api.github.com/repos/openclaw/openclaw/pulls/2090",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2726410464"
      },
      "html": {
        "href": "https://github.com/openclaw/openclaw/pull/2090#discussion_r2726410464"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/openclaw/openclaw/pulls/2090"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2726410464/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 68,
    "original_start_line": 68,
    "start_side": "RIGHT",
    "line": 73,
    "original_line": 73,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 20,
    "position": 1,
    "subject_type": "line"
  },
  {
    "url": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2726410473",
    "pull_request_review_id": 3704701584,
    "id": 2726410473,
    "node_id": "PRRC_kwDOQb6kR86igbjp",
    "diff_hunk": "@@ -63,15 +63,14 @@ export async function runCommandWithTimeout(\n   const { windowsVerbatimArguments } = options;\n   const hasInput = input !== undefined;\n \n-  const shouldSuppressNpmFund = (() => {\n-    const cmd = path.basename(argv[0] ?? \"\");\n-    if (cmd === \"npm\" || cmd === \"npm.cmd\" || cmd === \"npm.exe\") return true;\n-    if (cmd === \"node\" || cmd === \"node.exe\") {\n-      const script = argv[1] ?? \"\";\n-      return script.includes(\"npm-cli.js\");\n-    }\n-    return false;\n-  })();\n+  const cmd = path.basename(argv[0] ?? \"\");\n+  const isNpmCommand = cmd === \"npm\" || cmd === \"npm.cmd\" || cmd === \"npm.exe\";\n+  const isNpmViaCli =\n+    (cmd === \"node\" || cmd === \"node.exe\") && (argv[1] ?? \"\").includes(\"npm-cli.js\");\n+  const shouldSuppressNpmFund = isNpmCommand || isNpmViaCli;\n+\n+  // On Windows, npm is a .cmd batch file that requires shell mode to execute\n+  const useShell = process.platform === \"win32\" && isNpmCommand;",
    "path": "src/process/exec.ts",
    "commit_id": "2516dc78a110992b07619d1fd4c05e5761dd62ca",
    "original_commit_id": "2516dc78a110992b07619d1fd4c05e5761dd62ca",
    "user": {
      "login": "Copilot",
      "id": 175728472,
      "node_id": "BOT_kgDOCnlnWA",
      "avatar_url": "https://avatars.githubusercontent.com/in/946600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Copilot",
      "html_url": "https://github.com/apps/copilot-pull-request-reviewer",
      "followers_url": "https://api.github.com/users/Copilot/followers",
      "following_url": "https://api.github.com/users/Copilot/following{/other_user}",
      "gists_url": "https://api.github.com/users/Copilot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Copilot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Copilot/subscriptions",
      "organizations_url": "https://api.github.com/users/Copilot/orgs",
      "repos_url": "https://api.github.com/users/Copilot/repos",
      "events_url": "https://api.github.com/users/Copilot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Copilot/received_events",
      "type": "Bot",
      "user_view_type": "public",
      "site_admin": false
    },
    "body": "Consider adding a test case that verifies the shell mode behavior on Windows for npm commands. The existing tests in exec.test.ts don't cover the new Windows-specific shell mode logic. A test could mock process.platform and verify that shell is set correctly for npm/npm.cmd/npm.exe commands versus other commands.\n\nThis would help prevent regressions and document the expected behavior.",
    "created_at": "2026-01-26T05:47:04Z",
    "updated_at": "2026-01-26T05:47:04Z",
    "html_url": "https://github.com/openclaw/openclaw/pull/2090#discussion_r2726410473",
    "pull_request_url": "https://api.github.com/repos/openclaw/openclaw/pulls/2090",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2726410473"
      },
      "html": {
        "href": "https://github.com/openclaw/openclaw/pull/2090#discussion_r2726410473"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/openclaw/openclaw/pulls/2090"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/openclaw/openclaw/pulls/comments/2726410473/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 66,
    "original_start_line": 66,
    "start_side": "RIGHT",
    "line": 73,
    "original_line": 73,
    "side": "RIGHT",
    "author_association": "NONE",
    "original_position": 20,
    "position": 1,
    "subject_type": "line"
  }
]
